// Advanced example: modules + map/filter/fold + lambdas
// Run with:
// cargo run -- --root examples examples/Modules/advanced_map_filter_fold_pipeline.flx

import Modules.Analytics.Transforms as T
import Modules.Math as Math

print("Advanced module pipeline:")

let scores = [|18, 24, 35, 41, 50|]
let names = [|"  alice", "Bob  ", "cHaRlIe"|]

// Use module functions as callbacks
let doubled = map(scores, T.double)
let passing = filter(doubled, T.is_passing)
let total = fold(passing, 0, T.sum_step)

print("Doubled: " + to_string(doubled))
print("Passing: " + to_string(passing))
print("Total: " + to_string(total))
print("Total x2 (Math.double): " + to_string(Math.double(total)))

// Mix module callbacks and lambdas
let curved = map(scores, T.curve_by_five)
let curvedPassing = filter(curved, \x -> x >= 40)
let curvedAvg = fold(curvedPassing, 0, \(acc, x) -> acc + x) / len(curvedPassing)

print("Curved: " + to_string(curved))
print("Curved passing: " + to_string(curvedPassing))
print("Curved average: " + to_string(curvedAvg))

let cleaned = map(names, \name -> name |> trim |> lower)
let tagged = map(cleaned, T.shout_tag)

print("Tagged names: " + to_string(tagged))
